@using StationProject.Data.Models
@inject DialogService DialogService

<EditForm Model="@Product" OnValidSubmit="@Submit" class="f-column gap-10">
    <DataAnnotationsValidator/>

    <div class="form-group">
        <label>Название продукта:</label>
        <InputText @bind-Value="Product.Name" class="form-control"/>
    </div>

    <div class="form-group">
        <label>Количество на складе:</label>
        <InputNumber @bind-Value="Product.Count.Count" class="form-control"/>
    </div>

    <div class="form-group">
        <label>Цена продукта:</label>
        <InputNumber @bind-Value="Product.Price.Value" class="form-control"/>
    </div>

    <div class="form-group">
        <label>Описание продукта:</label>
        <InputTextArea @bind-Value="Product.Description" class="form-control"/>
    </div>

    <div class="form-group">
        <label>Характеристики продукта:</label>
        <InputTextArea @bind-Value="Product.Characteristics" class="form-control"/>
    </div>

    <div class="form-group">
        <label>Выберите категорию:</label>
        <InputSelect @bind-Value="Product.CategoryId" class="form-control">
            @foreach (var category in Categories)
            {
                <option value="@category.Id">@category.Name</option>
            }
        </InputSelect>
    </div>

    <div class="form-group">
        <label>URL изображения:</label>
        <InputText @bind-Value="newImageUrl" class="form-control" Placeholder="Введите URL изображения"/>
        <button type="button" class="btn btn-secondary mt-2" @onclick="@AddImageUrl">Добавить изображение</button>
    </div>

    @if (Product.Images.Any())
    {
        <h5>Добавленные изображения:</h5>
        <ul>
            @foreach (var image in Product.Images)
            {
                <li><img src="@image.Url" alt="Product Image" style="max-width: 100px; max-height: 100px;"/> @image.Url</li>
            }
        </ul>
    }

    <button type="submit" class="btn btn-primary">Подтвердить</button>
    <button type="button" class="btn btn-secondary" @onclick="@Close">Отмена</button>
</EditForm>

@code {
    [Parameter] public Product Product { get; set; } = new Product(); // Create a new Product instance
    [Parameter] public List<Category> Categories { get; set; } = new List<Category>();

    private string newImageUrl = string.Empty; // Variable to hold the new image URL

    private void AddImageUrl()
    {
        if (!string.IsNullOrWhiteSpace(newImageUrl))
        {
            // Add the new image URL to the product's Images collection
            Product.Images.Add(new ProductImage { Url = newImageUrl });
            newImageUrl = string.Empty; // Clear the input after adding
        }
    }

    private void Submit()
    {
        // Logic to save the product goes here
        // Assuming that Count and Price entities are created and linked properly
        DialogService.Close(Product); // Return the created Product with its relations
    }

    private void Close() => DialogService.Close();
}